<!DOCTYPE html><html lang="en"><head><title>app/index</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="app/index"><meta name="groc-project-path" content="app/index.js"><meta name="groc-github-url" content="https://github.com/jlengstorf/workshop-supercharge-your-front-end-workflow"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/jlengstorf/workshop-supercharge-your-front-end-workflow/blob/master/app/index.js">app/index.js</a></div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="indexjs">index.js</h1></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="load-required-modules">Load Required Modules</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Using <a href="http://expressjs.com/">Express</a> for a simple server/router setup</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> app = express();</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Avoid a 404 error for favicons with <a href="http://git.io/vTpcI"><code>serve-favicon</code></a></p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> favicon = <span class="hljs-built_in">require</span>(<span class="hljs-string">'serve-favicon'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Using <a href="http://git.io/vTp3i"><code>morgan</code></a> for logging HTTP requests</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> logger = <span class="hljs-built_in">require</span>(<span class="hljs-string">'morgan'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><a href="http://bit.ly/1Hs2ZUv"><code>path</code></a> is a filepath handling utility</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="set-app-variables">Set App Variables</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Check for a port in the ENV before setting one manually</p></div></div><div class="code"><div class="wrapper">app.set(<span class="hljs-string">'port'</span>, process.env.PORT || <span class="hljs-number">3000</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Views are written using <a href="http://jade-lang.com/">Jade templates</a></p></div></div><div class="code"><div class="wrapper">app.set(<span class="hljs-string">'views'</span>, path.join(__dirname, <span class="hljs-string">'server/views/'</span>));
app.set(<span class="hljs-string">'view engine'</span>, <span class="hljs-string">'jade'</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="create-routing">Create Routing</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The default route loads the home page.</p></div></div><div class="code"><div class="wrapper">app.get(<span class="hljs-string">'/'</span>, ( req, res ) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, {
    currentUrl: <span class="hljs-string">''</span>
  });
});</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Example pages are loaded by slug</p></div></div><div class="code"><div class="wrapper">app.get(<span class="hljs-string">'/:page/'</span>, ( req, res, next ) =&gt; {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>Make sure we&#39;re not getting a request for the favicon</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">if</span> (req.params.page!==<span class="hljs-string">'favicon.ico'</span>) {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>Try to render the template passed in the <code>page</code> param</li>
</ul></div></div><div class="code"><div class="wrapper">    res.render(req.params.page, {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>Used for determining which menu item should be active</li>
</ul></div></div><div class="code"><div class="wrapper">      currentUrl: req.path

    }, (err, html) =&gt; {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>If the template doesn&#39;t exist, send no output and move along (404)</li>
</ul></div></div><div class="code"><div class="wrapper">      <span class="hljs-keyword">if</span> (err) {
        next();
      } <span class="hljs-keyword">else</span> {
        res.send(html);
      }

    });

  }

});</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="add-middleware">Add Middleware</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Log requests in the console using morgan</p></div></div><div class="code"><div class="wrapper">app.use(logger(<span class="hljs-string">'dev'</span>));</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Static files are all stored in the <code>public</code> dir</p></div></div><div class="code"><div class="wrapper">app.use(express.static(path.join(__dirname, <span class="hljs-string">'public'</span>)));</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Use the favicon in the public folder</p></div></div><div class="code"><div class="wrapper">app.use(favicon(path.join(__dirname, <span class="hljs-string">'public/favicon.ico'</span>)));</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>If something goes wrong with the server, pass along the error message</p></div></div><div class="code"><div class="wrapper">app.use((err, req, res, next) =&gt; {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li>Log the full error stack for easier debugging</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="hljs-built_in">console</span>.error(err.stack);
  res.status(<span class="hljs-number">500</span>).send(err.message);

});</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Add 404 handling</p></div></div><div class="code"><div class="wrapper">app.use((req, res, next) =&gt; {
  res.status(<span class="hljs-number">404</span>).send(<span class="hljs-string">"The page you requested doesn't exist."</span>);
});</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="start-the-server">Start the Server</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> server = app.listen(app.get(<span class="hljs-string">'port'</span>), (  ) =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'App started and listening on port %s'</span>, server.address().port);
});</div></div></div></div></body></html>